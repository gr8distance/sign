// Generated by CoffeeScript 1.9.3
(function() {
  $(function() {
    var card_box, friend_box, h, load_more, load_more_friend, loading, loading_friend, parallax, parallax_height, parallax_img, w, wrf;
    $('.parallax').parallax();
    $(".dropdown-button").dropdown();
    $(".button-collapse").sideNav();
    $('.modal-trigger').leanModal();
    $(".dropdown-button").dropdown();
    $('.materialboxed').materialbox();
    $('.datepicker').pickadate({
      selectMonths: true,
      selectYears: 15
    });
    w = $(window);
    h = w.height();
    $("#before_login_page").css({
      height: h
    });
    wrf = $(".show_write_rep");
    wrf.on("click", function() {
      var form_id, this_id;
      this_id = $(this).attr("id");
      form_id = this_id + "_form";
      return $("#" + form_id).slideToggle();
    });
    w = $(window);
    parallax = $(".parallax-container");
    parallax_height = parallax.height() * 0.666;
    parallax_img = $(".parallax img");
    w.scroll(function() {
      var sc;
      sc = $(this).scrollTop();
      if (parallax_height < sc) {
        return parallax_img.addClass("blur");
      } else {
        return parallax_img.removeClass("blur");
      }
    });
    $("#sub").on("click", function() {
      var d, data;
      console.log("clicked");
      d = $("#dammy").val() || "stone";
      console.log(d);
      data = {};
      data.send = d;
      return $.post("/users/ajax", data, function(data) {
        return console.log("Return data");
      });
    });
    loading_friend = $("#loading_friend");
    load_more_friend = $("#load_more_friend");
    loading_friend.hide();
    friend_box = $("#friend_place");
    load_more_friend.on("click", function() {
      var all_friends, p, page_id;
      all_friends = $("#all_friends_id").val().split("_");
      console.log(all_friends);
      $(this).hide();
      loading_friend.show();
      page_id = $(".page_id");
      p = parseInt(page_id.val());
      page_id.val("" + (p + 1));
      return $.post("/friends/more", {
        page_id: p
      }, function(data) {
        var current_user_id;
        current_user_id = $("#current_user_id").val();
        return setTimeout(function() {
          var i, len, post_card, user;
          for (i = 0, len = data.length; i < len; i++) {
            user = data[i];
            post_card = "<article class='col s12 m6 l3'> <div class='card small'> <div class='card-image'><img src='" + (user.image != null ? user.image : '/images/colorfull2.jpg') + "' class='blur'> </div> <div class='card-content'><span class='card-title'><a href='/users/" + user.id + "' class='cyan-text'>" + user.name + "</a></span></div> <div class='card-action'> <a href='/users/" + user.id + "'>もっと詳しく</a> </div> </div> </article>";
            friend_box.append(post_card);
          }
          loading_friend.hide();
          return load_more_friend.fadeIn();
        }, 666);
      });
    });
    loading = $("#loading");
    load_more = $("#load_more");
    loading.hide();
    card_box = $("#card_box");
    load_more.on("click", function() {
      var create_delete_form, current_user_id, p, page_id;
      $(this).hide();
      loading.show();
      page_id = $(".page_id");
      p = parseInt(page_id.val());
      page_id.val("" + (p + 1));
      create_delete_form = function(post, current_user_id) {
        if (post.user_id === parseInt(current_user_id)) {
          return "<a href='/posts/" + post.id + "/edit'>編集</a><i id='delete_post_" + post.id + "_" + post.user_id + "' class='mdi-action-delete red-text tiny delete_post_form right'></i>";
        } else {
          return "";
        }
      };
      current_user_id = $("#current_user_id").val();
      return $.post("/posts/more", {
        page_id: p
      }, function(data) {
        return setTimeout(function() {
          var i, len, post, post_card;
          for (i = 0, len = data.length; i < len; i++) {
            post = data[i];
            post_card = "<article id='posted_card_" + post.id + "' class='col s12 m6'> <div class='card'> <div class='card-content'> <div class='row'> <div class='col s2 m3 l2'> <img src='" + (post.user_image != null ? post.user_image : "/images/amethyst_flat.png") + "' class='circle responsive-img'> </div> <div class='col s10 m9 l10'><span class='card-title cyan-text'>" + post.user_name + "</span></div> </div> <p>" + (post.body.replace(/\n/g, '<br/>')) + "</p> <span class='font_size_10 right'>" + post.created_at + "</span> </div> <div class='card-action'> <a href='/posts/" + post.id + "' class='teal-text'>コメント</a> " + (create_delete_form(post, current_user_id)) + " </div> </div> </article>";
            card_box.append(post_card);
          }
          loading.hide();
          return load_more.fadeIn();
        }, 666);
      });
    });
    $(".be_friend_form").submit(function(e) {
      var data, form_id, fr_sub, fs, url;
      e.preventDefault();
      fr_sub = $("#friend_follow_submit");
      fr_sub.hide();
      form_id = $(this).attr("id");
      fs = form_id.split("_");
      url = $(this).attr("action");
      data = {};
      data.user_id = fs[4];
      data.friend_id = fs[3];
      return $.post(url, data, function(data) {
        var BASE, path;
        Materialize.toast(data.flash, 3330);
        if (data.state) {
          fr_sub.show();
          BASE = "/friends";
          path = url.split("/")[2];
          switch (path) {
            case "follow":
              $("#" + form_id).attr("action", BASE + "/unfollow");
              return $("#" + form_id + " #friend_follow_submit").text("フォロー中").removeClass("blue").addClass("pink");
            case "unfollow":
              $("#" + form_id).attr("action", BASE + "/follow");
              return $("#" + form_id + " #friend_follow_submit").text("フォロー").removeClass("pink").addClass("blue");
          }
        }
      });
    });
    $("#edit_user_profile_form").submit(function(e) {
      var data, url;
      e.preventDefault();
      data = {};
      data.name = $("#user_name").val();
      data.email = $("#user_email").val();
      data.description = $("#user_profile").val();
      url = $(this).attr("action");
      return $.post(url, data, function(data) {
        if (data.state) {
          Materialize.toast(data.flash, 3330);
          $("#usr_name").text(data.name);
          $("#usr_email").text(data.email);
          $("#usr_prof").text(data.description);
          $("#user_name").text(data.name);
          $("#user_email").text(data.email);
          $("#user_profile").text(data.description);
          return $("#edit_user_profile").closeModal();
        } else {
          return Materialize.toast(data.flash, 3330);
        }
      });
    });
    $(".commit_cotery").submit(function(e) {
      var data, id, t, url;
      e.preventDefault();
      url = $(this).attr("action");
      id = $(".commit_btn").attr("id");
      data = {
        user_id: id.split("_")[3],
        cotery_id: id.split("_")[2]
      };
      t = $(this);
      return $.post(url, data, function(data) {
        if (data.state) {
          $(t).append("<p>サークルに参加希望をだしました</p>");
          $("#" + id).hide();
          return Materialize.toast(data.flash, 3330);
        } else {
          return Materialize.toast(data.flash, 3330);
        }
      });
    });
    $(".change_permit").submit(function(e) {
      var data, id, ids, url;
      e.preventDefault();
      console.log("clocked");
      url = $(this).attr("action");
      id = $(this).attr("id");
      ids = id.split("_");
      data = {
        cotery_id: ids[1],
        user_id: ids[2],
        permit_user_id: ids[3]
      };
      return $.post(url, data, function(data) {
        console.log(data);
        if (data.state) {
          Materialize.toast(data.flash, 3330);
          return $("#waiting_user_" + data.user_id).fadeOut();
        } else {
          return Materialize.toast(data.flash, 3330);
        }
      });
    });
    return $(document).on("click", ".delete_post_form", function() {
      var data, id, url;
      console.log("cliecled");
      id = $(this).attr("id");
      data = {
        post: id.split("_")[2],
        user: id.split("_")[3]
      };
      url = "/posts/" + data.post + "/delete";
      $("#posted_card_" + data.post).fadeOut();
      return $.post(url, data, function(data) {
        if (data.state) {
          return Materialize.toast(data.flash, 3330);
        } else {
          return Materialize.toast(data.flash, 3330);
        }
      });
    });
  });

}).call(this);
